-- 1. Tabela de Usuários
CREATE TABLE T_USUARIO (
    ID_USUARIO          NUMBER          GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NOME_USUARIO        VARCHAR2(150)   NOT NULL,
    EMAIL_USUARIO       VARCHAR2(100)   NOT NULL,
    SENHA_USUARIO       VARCHAR2(100)   NOT NULL,
    DT_CADASTRO         DATE            DEFAULT SYSDATE,
    ROLE                VARCHAR2(20)    DEFAULT 'USER' NOT NULL, -- Adicionado para Spring Security
    CONSTRAINT PK_USUARIO PRIMARY KEY (ID_USUARIO),
    CONSTRAINT UK_USUARIO_EMAIL UNIQUE (EMAIL_USUARIO)
);

-- 2. Tabela de Competências
CREATE TABLE T_COMPETENCIA (
    ID_COMPETENCIA      NUMBER          GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NOME_COMPETENCIA    VARCHAR2(100)   NOT NULL,
    DESCRICAO_COMP      VARCHAR2(300),
    CONSTRAINT PK_COMPETENCIA PRIMARY KEY (ID_COMPETENCIA),
    CONSTRAINT UK_COMPETENCIA_NOME UNIQUE (NOME_COMPETENCIA)
);

-- 3. Tabela de Vagas
CREATE TABLE T_VAGA (
    ID_VAGA             NUMBER          GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    TITULO_VAGA         VARCHAR2(150)   NOT NULL,
    DESCRICAO_VAGA      VARCHAR2(1000)  NOT NULL,
    EMPRESA_VAGA        VARCHAR2(100),
    SALARIO_MEDIO       NUMBER(10, 2),
    DT_PUBLICACAO       DATE            DEFAULT SYSDATE,
    CONSTRAINT PK_VAGA PRIMARY KEY (ID_VAGA)
);

-- 4. Tabela de Cursos
CREATE TABLE T_CURSO_REQUALIFICACAO (
    ID_CURSO            NUMBER          GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NOME_CURSO          VARCHAR2(200)   NOT NULL,
    INSTITUICAO_CURSO   VARCHAR2(100),
    LINK_CURSO          VARCHAR2(255),
    CONSTRAINT PK_CURSO PRIMARY KEY (ID_CURSO)
);

-- 5. Tabela de Associação: Usuario <-> Competencia
CREATE TABLE T_USUARIO_COMPETENCIA (
    ID_USUARIO          NUMBER          NOT NULL,
    ID_COMPETENCIA      NUMBER          NOT NULL,
    NIVEL_COMPETENCIA   VARCHAR2(50), -- Ex: 'Básico', 'Avançado'
    CONSTRAINT PK_USUARIO_COMP PRIMARY KEY (ID_USUARIO, ID_COMPETENCIA),
    CONSTRAINT FK_USU_COMP_USUARIO FOREIGN KEY (ID_USUARIO) 
        REFERENCES T_USUARIO (ID_USUARIO) ON DELETE CASCADE,
    CONSTRAINT FK_USU_COMP_COMP FOREIGN KEY (ID_COMPETENCIA) 
        REFERENCES T_COMPETENCIA (ID_COMPETENCIA) ON DELETE CASCADE
);

-- 6. Tabela de Associação: Vaga <-> Competencia
CREATE TABLE T_VAGA_COMPETENCIA (
    ID_VAGA             NUMBER          NOT NULL,
    ID_COMPETENCIA      NUMBER          NOT NULL,
    CONSTRAINT PK_VAGA_COMP PRIMARY KEY (ID_VAGA, ID_COMPETENCIA),
    CONSTRAINT FK_VAGA_COMP_VAGA FOREIGN KEY (ID_VAGA) 
        REFERENCES T_VAGA (ID_VAGA) ON DELETE CASCADE,
    CONSTRAINT FK_VAGA_COMP_COMP FOREIGN KEY (ID_COMPETENCIA) 
        REFERENCES T_COMPETENCIA (ID_COMPETENCIA) ON DELETE CASCADE
);

-- 7. Tabela de Associação: Curso <-> Competencia
CREATE TABLE T_CURSO_COMPETENCIA (
    ID_CURSO            NUMBER          NOT NULL,
    ID_COMPETENCIA      NUMBER          NOT NULL,
    CONSTRAINT PK_CURSO_COMP PRIMARY KEY (ID_CURSO, ID_COMPETENCIA),
    CONSTRAINT FK_CURSO_COMP_CURSO FOREIGN KEY (ID_CURSO) 
        REFERENCES T_CURSO_REQUALIFICACAO (ID_CURSO) ON DELETE CASCADE,
    CONSTRAINT FK_CURSO_COMP_COMP FOREIGN KEY (ID_COMPETENCIA) 
        REFERENCES T_COMPETENCIA (ID_COMPETENCIA) ON DELETE CASCADE
);

-- 8. Tabela de Auditoria 
CREATE TABLE T_AUDITORIA_TRANSACOES (
    ID_AUDITORIA        NUMBER          GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NOME_TABELA         VARCHAR2(50)    NOT NULL,
    OPERACAO            VARCHAR2(10)    NOT NULL, -- 'INSERT', 'UPDATE', 'DELETE'
    USUARIO_DB          VARCHAR2(50)    NOT NULL,
    DT_OPERACAO         DATE            DEFAULT SYSDATE,
    DADOS_ANTIGOS       CLOB,
    DADOS_NOVOS         CLOB,
    CONSTRAINT PK_AUDITORIA PRIMARY KEY (ID_AUDITORIA)
);